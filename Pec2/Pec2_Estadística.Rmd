---
title: "Actividad 2: n√°lisis descriptivo e inferencial"
author: "Gonzalo Mellizo-Soto D√≠az"
output: html_notebook
---

```{r}
library(ggplot2)
```


# 1. Carga de los datos

**Cargar el archivo de datos ‚ÄúFumadores_clean_5Y.csv‚Äù y validar que los tipos de datos se interpretan correctamente.**

Cargamos los datos iniciales y comprobamos los tipos

```{r}
fumadoresClean <- read.csv('Fumadores_clean_5Y.csv')
head(fumadoresClean)
```

```{r}
str(fumadoresClean)
```

Vemos como los datos se cargan correctamente y los factores son expresados como tal (se podr√≠a mantener el ordinal realizado en la pr√°ctica anterior) y como las variable num√©ricas se convierten bien a integer o double seg√∫n la necesidad.

# 2. Estad√≠stica descriptiva

**En primer lugar, estudiaremos los valores centrales y de dispersi√≥n de algunas variables del conjunto de datos. Siga los pasos que se especifican a continuaci√≥n**

## 2.1 Valores centrales

**Media, mediana y los cinco n√∫meros (de Tukey) de la capacidad pulmonar.**

```{r}
print(paste("La media de la capacidad pulmonar es: ",
            mean(fumadoresClean$PC)))
print(paste("La mediana de la capacidad pulmonar es: ",
            median(fumadoresClean$PC)))
print("El resumen de los cinco n√∫meros es: ")
summary(fumadoresClean$PC)
```

El punto medio ser√≠a la media entre el punto 150 y 151 del vector (ordenado), en este caso coincidiendo con la mediana. El summary tambi√©n muestra la media por lo que se podr√≠a realizar en un simple comando.


**Visualizar la muestra de valores en un diagrama de caja (boxplot)**

Para la visualizaci√≥n utilizaremos ggplot2

```{r fig.height=6, fig.width=4}
ggplot(data = fumadoresClean, aes(x = 'PC', y = PC))+
  geom_boxplot()+
  theme_bw()
```


**¬øSe detectan valores extremos (outliers) en el diagrama?**

Si, se detecta un valor at√≠pico, el valor m√≠nimo de 1.557.

** A continuaci√≥n, mostrar mediante diagramas de caja la capacidad pulmonar separando el g√©nero femenino y el masculino**

```{r}
ggplot(fumadoresClean, aes(x = Sex, y = PC, fill = Sex))+
  geom_boxplot()+
  theme_bw()
```


Se puede apreciar como la capacidad pulmonar es mayor y ligeramente menos dispersa para el g√©nero masculino.

**Mostrar, finalmente, mediante diagramas de caja la comparaci√≥n entre el valor de PC original y al cabo de 5 a√±os. Interpretar los resultados.**

```{r}
ggplot(data = fumadoresClean) + 
  geom_boxplot(aes(x = 'PC', y = PC, fill = "PC"))+
  geom_boxplot(aes(x = "PC5Y", y = PC5Y, fill = "PC5Y"))+
  theme_bw()
```


Seg√∫n la distribuci√≥n de las cajas, podemos concluir con que a los 5 a√±os se muestran valores m√°s dispersos, por ejemplo, el valor at√≠pico tras los cinco a√±os deja de serlo.

La mediana se mantiene estable (ligeramente m√°s baja), mientras que los valores entre el primer cuartil y la mediana son m√°s dispersos que en la toma inicial.


## 2.2 Dispersi√≥n

**Calcular la dispersi√≥n de la capacidad pulmonar usando las medidas: varianza, desviaci√≥n t√≠pica y rango intercuart√≠lico.**

Las medidas de dispersi√≥n son las siguientes:

```{r}
print(paste("La varianza es:",  var(fumadoresClean$PC)))
print(paste("La desviaci√≥n t√≠pica es:", sd(fumadoresClean$PC)))
print(paste("El rango intercuart√≠lico es:", IQR(fumadoresClean$PC)))

```


## 2.3 C√°lculo manual de la dispersi√≥n

**Calcular la desviaci√≥n t√≠pica de la capacidad pulmonar manualmente y comparar el resultado con la funci√≥n correspondiente de R.**

Implementamos manualmente la funci√≥n:

```{r}
sqrt(sum((fumadoresClean$PC - mean(fumadoresClean$PC))^2)/ (length(fumadoresClean$PC)))
```
 Existe una diferencia y es que la funci√≥n de R utiliza la varianza muestral, N-1 en lugar de N:
 
```{r}
sqrt(sum((fumadoresClean$PC - mean(fumadoresClean$PC))^2)/ (length(fumadoresClean$PC) - 1))
```
 
## 2.4 Histograma
 
**Representar un histograma de la variable PC. Si es necesario, configura los par√°metros del histograma para que se vea con una buena precisi√≥n.** 

```{r}
ggplot(fumadoresClean, aes(x=PC))+
  geom_histogram(bins = 35)+
  theme_bw()
```

Este gr√°fico nos ayuda a comprender la distribuci√≥n de los datos, en este caso se observa claramente como la mayor√≠a de datos se encuentran comprendidos entre los valores 3 y 4.


## 2.5 Datos categ√≥ricos

**En las variables Sex, Sport y City, realizar un resumen num√©rico y dibujar un diagrama circular que muestre la proporci√≥n de casos de cada categoria**

```{r}
print("El resumen num√©rico de 'Sex' es:")
print(summary(fumadoresClean$Sex))
print("El resumen num√©rico de 'Sport' es:")
print(summary(fumadoresClean$Sport))
print("El resumen num√©rico de 'City' es:")
print(summary(fumadoresClean$City))
```

Los diagramas de cada uno son los siguientes:

```{r}
ggplot(fumadoresClean)+
  geom_bar(aes(x = factor(1), fill = Sex), width = 1)+
  ggtitle('Proporci√≥n de g√©neros en Sex')+
  coord_polar('y')+
  theme_bw()
```

Se observa como la mayor parte de los fumadores son hombres.

```{r}
ggplot(fumadoresClean)+
  geom_bar(aes(x = factor(1), fill = Sport), width = 1)+
  ggtitle('Proporci√≥n de cantidad de deporte en Sport')+
  coord_polar('y')+
  theme_bw()
```
Se oberva claramente como la mayor parte realiza ejercicio todos los d√≠as y en segundo puesto los que no se ejercitan.

```{r}
ggplot(fumadoresClean)+
  geom_bar(aes(x = factor(1), fill = City), width = 1)+
  ggtitle('Proporci√≥n de ciudades en City')+
  coord_polar('y')+
  theme_bw()
```

Se observa claramente la mayor participaci√≥n de personas de Barcelona (mayor densidad poblacional) y de Terrasa


# 3. Estad√≠stica inferencial

## 3.1 Intervalo de confianza

**Calcular el intervalo de confianza del 97 % de la capacidad pulmonar de la poblaci√≥n.**

**Nota: Se deben realizar los c√°lculos manualmente. No se pueden usar funciones de R que calculen directamente el intervalo de confianza como t.test o similar. Si que podeis usar funciones como qnorm, pnorm , qt y pt.**

Fijamos los par√°metros y calculamos

```{r}
intervalo <- 0.97
s <- sd(fumadoresClean$PC)
errorSd <- s/sqrt(length(fumadoresClean$PC))
valorCritico <- (1-intervalo)/2
tValue <- qt(c(valorCritico, 1-valorCritico), df=(length(fumadoresClean$PC)-1))
margenError <- tValue * errorSd
inicioIntervalo <- mean(fumadoresClean$PC) + margenError[1]
finIntervalo <- mean(fumadoresClean$PC) + margenError[2]

print(paste0("El intervalo de confianza es: [", inicioIntervalo, ',', finIntervalo, ']'))
```


## 3.2 Analizar la capacidad pulmonar de las mujeres

**Asumimos que conocemos la capacidad pulmonar media de la poblaci√≥n, que es igual a 3.30. ¬øPodemos decir que la capacidad pulmonar de las mujeres es inferior a la media poblacional, con un nivel de confianza del 95 %? Para responder a esta pregunta, siga los pasos que se indican.**

**Nota: Se deben realizar los c√°lculos manualmente. No se pueden usar funciones de R que calculen directamente el intervalo de confianza como t.test o similar. Si que podeis usar funciones como qnorm, pnorm , qt y pt.**

### 3.2.1 Escribir la hip√≥tesis nula y alternativa

* La hip√≥tesis nula  H0 es: "La capacidad pulmonar de las mujeres es igual a 3.30" meanPC = 3.30

* La hip√≥tesis alternativa (unilateral) es: "La capacidad pulmonar de las mujeres es menor a la media poblacional" meanPC(mujeres) < 3.30

### 3.2.2 M√©todo

**Indicar cu√°l es el m√©todo m√°s apropiado para hacer este an√°lisis, en funci√≥n de las caracter√≠sticas de la muestra y el objetivo del an√°lisis.**

En este caso se utilizara un m√©todo de contraste entre las medias de las poblaciones, basado en el p-valor para rechazar o aceptar la hip√≥tesis nula, sabiendo que en este caso se trata de un problema donde la desviacion tipica no es conocida.

### 3.2.3. Calcular el estadÌstico de contraste, el valor crÌtico y el valor p

El estadÌstico de contraste es el siguiente: (x - u) / (s/n^0.5)

```{r}
u <-  3.30
x <- mean(fumadoresClean[fumadoresClean$Sex == 'F',]$PC)
s <- sd(fumadoresClean[fumadoresClean$Sex == 'F',]$PC)
n <- nrow(fumadoresClean[fumadoresClean$Sex == 'F',])

t <- (x - u) / (s/sqrt(n))
print(paste("El Èstadistico del contraste es: ", t))
```

```{r}
valCritico <- qt(p = 0.95, df = 136)
print(paste("El valor critico es: ", valCritico))
```

Por lo tanto el valor crÌtico es mayor al valor del estadÌstico de contraste, `t<valCritico`, dado que para aceptar el valor t136 debe de ser mayor que t (el calculado) se deberÌa de aceptar la hipÛtesis nula.

Utilizando los valores calculados sacamos el p-valor:

```{r}
p_value <- pt(q = t, lower.tail = TRUE, df = 136)
print(paste("El p-valor es: ", p_value))
```

Como el p-valor es mayor que el grado de significacion se debe de aceptar la hipÛtesis nula.

### 3.2.4. Interpretar el resultado

Como se acepta la hipotesis nula no podemos concluir que la capacidad pulmonar de las mujeres es inferior al valor de la media de la capacidad pulmonar poblacional.


## 3.3. ComparaciÛn entre fumadores y no fumadores

**Nos preguntamos si la capacidad pulmonar de los fumadores es inferior a la capacidad pulmonar de los no fumadores. Aplicar un test de hipÛtesis para contrastar la hipÛtesis anterior con un 95 % de confianza e interpretar el resultado**

**Nota: Se deben realizar los c√°lculos manualmente. No se pueden usar funciones de R que calculen directamente el intervalo de confianza como t.test o similar. Si que podeis usar funciones como qnorm, pnorm , qt y pt.**

### 3.3.1. HipÛtesis nula y alternativa

* La hip√≥tesis nula  H0 es: "La capacidad pulmonar de los no fumadores es" meanPC(nofumadores) = 3.77

```{r}
u <- mean(fumadoresClean[fumadoresClean$Cig == 0,]$PC)
```


* La hip√≥tesis alternativa (unilateral) es: "La capacidad pulmonar de los fumadores es menor a la media de la capacidad pulmonar de los no fumadores" meanPC(fumadores) < meanPC(nofumadores) 

### 3.3.2. MÈtodo

**Explicar el mÈtodo que aplicarÈis para realizar este contraste y justificalo**

Al tratarse de unas muestras de una cantidad mayor a 80 observaciones, se van a tratar como variables que siguen una distribuciÛn normal, por lo tanto se va a aplicar un contraste de hipÛtesis utilizando el caso de la varianza conocida

### 3.2.3. Calcular el estadÌstico de contraste, el valor crÌtico y el valor p.

El estadÌstico de contraste es el siguiente: (x - u) / (sigma/n^0.5)

```{r}
u <-  mean(fumadoresClean[fumadoresClean$Cig == 0,]$PC)
x <- mean(fumadoresClean[fumadoresClean$Cig != 0,]$PC)
sigma <- sd(fumadoresClean[fumadoresClean$Cig != 0,]$PC)
n <- nrow(fumadoresClean[fumadoresClean$Cig != 0,])

t <- (x - u) / (sigma/sqrt(n))
print(paste("El Èstadistico del contraste es: ", t))
```

```{r}
valCritico <- qt(p = 0.95, df = n-1)
print(paste("El valor critico es: ", valCritico))
```

Por lo tanto el valor crÌtico es mayor al valor del estadÌstico de contraste, `t<valCritico`, dado que para aceptar el valor t130 debe de ser mayor que t (el calculado) se deberÌa de aceptar la hipÛtesis nula.

Utilizando los valores calculados sacamos el p-valor:

```{r}
p_value <- pt(q = t, lower.tail = TRUE, df = n-1)
print(paste("El p-valor es: ", p_value))
```

### 3.3.4. øY al 99% de confianza? Rehacer los c·lculos

```{r}
u <-  mean(fumadoresClean[fumadoresClean$Cig == 0,]$PC)
x <- mean(fumadoresClean[fumadoresClean$Cig != 0,]$PC)
sigma <- sd(fumadoresClean[fumadoresClean$Cig != 0,]$PC)
n <- nrow(fumadoresClean[fumadoresClean$Cig != 0,])

t <- (x - u) / (sigma/sqrt(n))
print(paste("El Èstadistico del contraste es: ", t))

valCritico <- qt(p = 0.99, df = n-1)
print(paste("El valor critico es: ", valCritico))

p_value <- pt(q = t, lower.tail = TRUE, df = n-1)
print(paste("El p-valor es: ", p_value))
```

### 3.3.5. InterpretaciÛn

**Interpretar los resultados obtenidos**

Para ambos casos el valor
